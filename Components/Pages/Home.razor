@page "/"
@using MauiApp7.Models;
@using MauiApp7.Data;
@using Microsoft.Data.SqlClient;

<h2>Registrar Nuevo Alumno</h2>

<EditForm Model="@nuevoAlumno" OnValidSubmit="GuardarAlumno">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label>Nombre:</label>
        <InputText class="form-control" @bind-Value="nuevoAlumno.Nombre" />
    </div>

    <div class="mb-3">
        <label>Apellido Paterno:</label>
        <InputText class="form-control" @bind-Value="nuevoAlumno.ApePat" />
    </div>

    <div class="mb-3">
        <label>Apellido Materno:</label>
        <InputText class="form-control" @bind-Value="nuevoAlumno.ApeMat" />
    </div>

    <div class="mb-3">
        <label>CURP (18 caracteres):</label>
        <InputText class="form-control" @bind-Value="nuevoAlumno.CURP" />
    </div>

    <div class="mb-3">
        <label>Matrícula:</label>
        <InputText class="form-control" @bind-Value="nuevoAlumno.Matricula" />
    </div>

    <div class="mb-3">
        <label>Teléfono:</label>
        <InputText class="form-control" @bind-Value="nuevoAlumno.Telefono" />
    </div>

    <button type="submit" class="btn btn-primary">Registrar Alumno</button>
</EditForm>

@if (!string.IsNullOrEmpty(Mensaje))
{
    <div class="mt-3 alert @(Exito ? "alert-success" : "alert-danger")">
        @Mensaje
    </div>
}

@code {
    private Alumno nuevoAlumno = new();
    private string Mensaje = string.Empty;
    private bool Exito = false;

    private async Task GuardarAlumno()
    {
        try
        {
            bool insertado = await DatabaseConnection.InsertarAlumnoAsync(nuevoAlumno);
            if (insertado)
            {
                Mensaje = "Alumno registrado correctamente.";
                Exito = true;
                // Limpiar formulario
                nuevoAlumno = new();
            }
            else
            {
                Mensaje = "Ya existe un alumno con esa CURP o matrícula.";
                Exito = false;
            }
        }
        catch (Exception ex)
        {
            Mensaje = $"Error: {ex.Message}";
            Exito = false;
        }
    }
}